<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HaiFire</title>

    <!-- SEO Meta -->
    <meta name="description" content="Get the hottest news and daily blogs with HaiFire. Fast updates, smart insights, and stories that matter." />
    <meta name="robots" content="index, follow" />
    <meta name="googlebot" content="index, follow" />

    <!-- SITEMAP -->
    <link rel="sitemap" type="application/xml" title="Sitemap" href="https://haifire.vercel.app/sitemap.xml">
    <link rel="sitemap" type="text/plain" title="Sitemap" href="https://haifire.vercel.app/sitemap.txt">
    
    
    <!-- Canonical -->
    <link rel="canonical" href="https://haifire.vercel.app/" />

    <!-- Open Graph -->
    <meta property="og:title" content="HaiFire - Stay Tranding" />
    <meta property="og:description" content="Get the hottest news and daily blogs with HaiFire. Fast updates, smart insights, and stories that matter." />
    <meta property="og:image" content="/favicon.png" />
    <meta property="og:url" content="https://haifire.vercel.app/" />
    <meta property="og:type" content="website" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="HaiFire - Stay Tranding" />
    <meta name="twitter:description" content="Get the hottest news and daily blogs with HaiFire. Fast updates, smart insights, and stories that matter." />
    <meta name="twitter:image" content="/favicon.png" />

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/favicon.png">
    <link rel="apple-touch-icon" href="/favicon.png" />

    <meta name="theme-color" content="#000000" />   
   
    <!-- Manifest -->
    <link rel="manifest" href="/site.webmanifest" />


    <!-- Google Fonts and Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Roboto+Mono&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

    <!-- highlight.js for Code Formatting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>

    <!-- CSS Styles -->
    <style>
        :root {
            --bg-primary: #17181a;
            --bg-secondary: #202225;
            --bg-tertiary: #2c2f33;
            --bg-code: #101214;
            --bg-hover: #35383c;
            --text-primary: #f0f2f5;
            --text-secondary: #a8b3cf;
            --text-active: #82aaff;
            --border-color: #3a3d42;
            --error-color: #ff8a80;
            --success-color: #89ddff;
            --sidebar-width: 260px;
            --font-family: 'Inter', sans-serif;
            --font-family-code: 'Roboto Mono', monospace;
        }

        /* --- Animations --- */
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; } }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }

        /* --- Button Click Animation --- */
        @keyframes buttonPressEffect {
            0% { transform: scale(1); }
            50% { transform: scale(0.95); }
            100% { transform: scale(1); }
        }
        .button-press-animation {
            animation: buttonPressEffect 0.2s ease-out;
        }

        /* Base & Reset */
        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        html, body { height: 100%; overflow: hidden; background-color: var(--bg-primary); color: var(--text-primary); font-family: var(--font-family); font-size: 16px; }
        button, a { background: none; border: none; cursor: pointer; color: inherit; text-decoration: none; font-family: inherit; }
        .material-symbols-outlined { font-variation-settings: 'FILL' 0, 'wght' 300, 'GRAD' 0, 'opsz' 24; font-size: 20px; color: var(--text-secondary); transition: color 0.2s; user-select: none; }
        *:focus-visible { outline: 2px solid var(--text-active); outline-offset: 2px; border-radius: 4px; }

        /* Main Layout */
        .app-container { display: flex; width: 100%; height: 100%; }
        .main-wrapper { width: 100%; height: 100%; display: flex; flex-direction: column; }
        .main-header { display: flex; align-items: center; padding: 12px 24px; background-color: rgba(23, 24, 26, 0.7); backdrop-filter: blur(12px); border-bottom: 1px solid var(--border-color); flex-shrink: 0; position: sticky; top: 0; z-index: 100; gap: 16px; }
        .header-title { font-size: 1.1rem; font-weight: 600; }
        .header-actions { margin-left: auto; display: flex; align-items: center; gap: 8px; }
        .icon-button { padding: 8px; border-radius: 50%; display: flex; transition: background-color 0.2s; }
        .icon-button:hover { background-color: var(--bg-hover); }
        .content-area { flex-grow: 1; overflow: hidden; position: relative; }

        /* Sidebar */
        #left-sidebar { position: fixed; top: 0; left: 0; height: 100%; width: var(--sidebar-width); max-width: 85%; background-color: var(--bg-secondary); border-right: 1px solid var(--border-color); display: flex; flex-direction: column; z-index: 1001; transform: translateX(-100%); transition: transform 0.3s ease-in-out; }
        body.left-sidebar-open #left-sidebar { transform: translateX(0); }
        .sidebar-content { padding: 16px; display: flex; flex-direction: column; flex-grow: 1; overflow-y: auto; }
        .sidebar-header { font-size: 1.75rem; font-weight: 700; padding: 12px; margin-bottom: 24px; }
        .sidebar-nav a, .sidebar-nav button { font-size: 1em; display: flex; align-items: center; gap: 16px; padding: 12px; border-radius: 8px; font-weight: 500; transition: background-color 0.2s, color 0.2s, opacity 0.2s; color: var(--text-secondary); text-align: left; width: 100%; }
        .sidebar-nav a:hover, .sidebar-nav button:hover { background-color: var(--bg-hover); color: var(--text-primary); }
        .sidebar-nav a.active { background-color: var(--bg-tertiary); color: var(--text-primary); }
        .sidebar-footer { margin-top: auto; padding-top: 16px; border-top: 1px solid var(--border-color); }

        /* Screen Layout */
        .screen { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; animation: fadeIn 0.5s ease; }
        .screen.active { display: block; }
        #home-screen, #profile-screen, #create-post-screen { overflow-y: auto; padding: 16px 8px; }
        .content-wrapper { max-width: 820px; width: 100%; margin: 0 auto; padding: 16px 0; }
        .page-header { margin-bottom: 24px; padding: 0 16px; }
        .page-header h2 { font-size: 1.75rem; }

        /* --- Banner Slider --- */
        #banner-slider-container {
            margin: 0 16px 24px;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            display: none; /* Hidden by default */
        }
        #banner-slider-track-wrapper {
            overflow: hidden;
        }
        #banner-slider-track {
            display: flex;
            transition: transform 0.5s ease-in-out;
        }
        .banner-slide {
            min-width: 100%;
            position: relative;
            line-height: 0; /* Remove space below image */
        }
        .banner-slide img {
            width: 100%;
            height: auto;
            object-fit: cover;
            max-height: 400px;
        }
        .banner-slider-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            padding: 8px;
            background-color: rgba(0, 0, 0, 0.5);
            border-radius: 50%;
            color: white;
            z-index: 1;
        }
        .banner-slider-nav:hover {
            background-color: rgba(0, 0, 0, 0.8);
        }
        .banner-slider-nav.prev { left: 16px; }
        .banner-slider-nav.next { right: 16px; }

        /* Home Screen & Search */
        .suggestion-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 16px; padding: 0 16px; }
        .suggestion-card { display: flex; flex-direction: column; background-color: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 8px; transition: background-color 0.2s, border-color 0.2s, transform 0.2s; animation: fadeInUp 0.5s ease-out both; overflow: hidden; text-decoration: none; }
        .suggestion-card-content { padding: 20px; }
        .suggestion-card:hover { background-color: var(--bg-tertiary); border-color: #4f5257; transform: translateY(-3px); }
        .suggestion-card-image { width: 100%; height: 180px; object-fit: cover; border-bottom: 1px solid var(--border-color); }
        .suggestion-card h3 { font-size: 1.1rem; font-weight: 600; margin-bottom: 8px; color: var(--text-primary); }
        .suggestion-card p { font-size: 0.95rem; color: var(--text-secondary); line-height: 1.6; }
        
        /* Search Bar in Header */
        .search-wrapper { position: relative; flex-grow: 1; max-width: 720px; }
        .search-input { width: 100%; background-color: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 8px; padding: 10px 16px 10px 44px; font-size: 0.95rem; color: var(--text-primary); outline: none; transition: border-color 0.2s; }
        .search-input:focus { border-color: var(--text-active); }
        .search-wrapper .material-symbols-outlined { position: absolute; top: 50%; left: 16px; transform: translateY(-50%); color: var(--text-secondary); pointer-events: none; }

        /* --- Skeleton Loading --- */
        .skeleton-card { background-color: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 8px; overflow: hidden; }
        .skeleton { background: linear-gradient(90deg, var(--bg-tertiary) 25%, var(--bg-hover) 50%, var(--bg-tertiary) 75%); background-size: 200% 100%; animation: shimmer 1.5s infinite linear; border-radius: 6px; }
        .skeleton-card .suggestion-card-content { padding: 20px; }
        .skeleton-image { width: 100%; height: 180px; border-radius: 0; border-bottom: 1px solid var(--border-color); }
        .skeleton-title { height: 24px; width: 70%; margin-bottom: 12px; }
        .skeleton-text { height: 18px; width: 90%; }

        /* Forms & Buttons */
        .profile-card { background-color: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 8px; padding: 24px; margin-bottom: 24px; }
        .profile-card p { margin-bottom: 16px; font-size: 1.1rem; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; font-size: 0.9rem; font-weight: 500; color: var(--text-secondary); margin-bottom: 8px; }
        .form-group input, .form-group textarea { width: 100%; background-color: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: 6px; padding: 12px; font-size: 1rem; color: var(--text-primary); outline: none; transition: border-color 0.2s; }
        .form-group input:focus, .form-group textarea:focus { border-color: var(--text-active); }
        .form-group textarea { resize: vertical; min-height: 150px; font-family: var(--font-family); }
        .profile-actions { display: flex; justify-content: flex-end; gap: 12px; margin-top: 16px; }
        .btn { padding: 10px 20px; font-weight: 600; border-radius: 8px; transition: all 0.2s ease; display: inline-flex; align-items: center; justify-content: center; text-decoration: none; }
        .btn:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        .btn-primary { background-color: var(--text-active); color: var(--bg-primary); }
        .btn-primary:hover:not(:disabled) { opacity: 0.9; }
        .btn-secondary { background: none; border: 1px solid var(--border-color); color: var(--text-primary); }
        .btn-secondary:hover:not(:disabled) { background-color: var(--bg-hover); }
        .btn-danger { background-color: var(--error-color); color: var(--bg-primary); }
        .btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; box-shadow: none; }

        /* Modal Component */
        .modal-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 2000; pointer-events: none; }
        .modal-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.7); display: flex; align-items: center; justify-content: center; opacity: 0; transition: opacity 0.3s; pointer-events: none; }
        .modal-overlay.visible { opacity: 1; pointer-events: auto; }
        .modal-content { background-color: var(--bg-secondary); border-radius: 12px; border: 1px solid var(--border-color); width: 90%; max-width: 600px; transform: translateY(20px); transition: transform 0.3s; }
        .modal-overlay.visible .modal-content { transform: translateY(0); }
        .modal-header { display: flex; justify-content: space-between; align-items: center; padding: 24px 24px 16px; border-bottom: 1px solid var(--border-color); }
        .modal-header h2 { font-size: 1.25rem; font-weight: 600; }
        .modal-body { padding: 24px; max-height: 70vh; overflow-y: auto; line-height: 1.7; color: var(--text-secondary); }
        #post-modal-content p { margin-bottom: 1em; white-space: pre-wrap; word-break: break-word; }
        #post-modal-image-container img { max-width: 100%; border-radius: 8px; margin-bottom: 16px; }
        .modal-footer { padding: 16px 24px; display: flex; justify-content: flex-end; gap: 12px; border-top: 1px solid var(--border-color); }

        /* Centered Open Button Styles */
        .open-link-container { text-align: center; padding: 24px 0 8px 0; }
        .btn-open-link { width: 80%; max-width: 400px; padding: 12px 24px; font-size: 1.1rem; }
        
        /* Auth Modal Specifics */
        .auth-view { display: none; }
        .auth-view.active { display: block; }
        .auth-footer-text { margin-top: 24px; text-align: center; font-size: 0.9rem; color: var(--text-secondary); }
        .auth-footer-text a { color: var(--text-active); font-weight: 500; }
        .auth-footer-text a:hover { text-decoration: underline; }
        .auth-divider { font-size: 0.8rem; color: var(--text-secondary); text-align: center; margin: 20px 0; position: relative; }
        .auth-divider::before, .auth-divider::after { content: ''; position: absolute; top: 50%; width: 40%; height: 1px; background-color: var(--border-color); }
        .auth-divider::before { left: 0; }
        .auth-divider::after { right: 0; }
        .btn-google { width: 100%; display: flex; justify-content: center; align-items: center; gap: 12px; }
        .btn-google svg { width: 18px; height: 18px; flex-shrink: 0; }
        
        /* Toast Notification */
        .toast-container { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); z-index: 3000; pointer-events: none; }
        .toast { background-color: var(--bg-tertiary); color: var(--text-primary); padding: 12px 24px; border-radius: 8px; border-left: 4px solid var(--success-color); box-shadow: 0 4px 12px rgba(0,0,0,0.3); opacity: 0; transform: translateY(20px); transition: opacity 0.3s, transform 0.3s; font-weight: 500; }
        .toast.show { opacity: 1; transform: translateY(0); }
        .toast.error { border-left-color: var(--error-color); }

        /* Notification Styles */
        #notification-area { position: relative; }
        #notification-bell-btn .material-symbols-outlined { color: var(--text-primary); }
        #notification-count { position: absolute; top: 2px; right: 2px; background-color: var(--error-color); color: var(--bg-primary); border-radius: 50%; width: 18px; height: 18px; font-size: 11px; font-weight: 600; display: flex; align-items: center; justify-content: center; transform: scale(0); transition: transform 0.2s ease; }
        #notification-count.visible { transform: scale(1); }
        #notification-panel { display: none; position: absolute; top: calc(100% + 12px); right: 0; width: 350px; max-width: 90vw; background-color: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 8px; box-shadow: 0 8px 24px rgba(0,0,0,0.3); z-index: 101; max-height: 400px; overflow-y: auto; }
        #notification-panel.visible { display: block; animation: fadeInUp 0.3s ease; }
        .notification-list { list-style: none; }
        .notification-item { padding: 12px 16px; border-bottom: 1px solid var(--border-color); cursor: pointer; transition: background-color 0.2s; }
        .notification-item:last-child { border-bottom: none; }
        .notification-item:hover { background-color: var(--bg-hover); }
        .notification-item.unread { background-color: rgba(130, 170, 255, 0.1); }
        .notification-item p { font-size: 0.9rem; line-height: 1.5; color: var(--text-primary); }
        .notification-item span { font-size: 0.8rem; color: var(--text-secondary); margin-top: 4px; display: block; }
        .no-notifications { padding: 24px; text-align: center; color: var(--text-secondary); }
        
        /* Code Box Styles */
        .pre-container { background-color: var(--bg-code); border: 1px solid var(--border-color); border-radius: 8px; margin: 1.5em 0; overflow: hidden; }
        .pre-header { display: flex; justify-content: space-between; align-items: center; padding: 8px 8px 8px 16px; background-color: var(--bg-tertiary); border-bottom: 1px solid var(--border-color); }
        .code-lang-name { font-family: var(--font-family-code); font-size: 0.85rem; color: var(--text-secondary); text-transform: uppercase; }
        .pre-header-actions { display: flex; gap: 4px; }
        .pre-header-actions .icon-button { padding: 6px; }
        .pre-header-actions .material-symbols-outlined { font-size: 18px; }
        #post-modal-content pre { margin: 0; border: none; border-radius: 0 0 8px 8px; padding: 16px; white-space: pre-wrap; word-wrap: break-word; overflow-x: auto; background-color: transparent; }
        #post-modal-content pre.code-collapsed { display: none; }
        #post-modal-content code.hljs { background: none; padding: 0; font-family: var(--font-family-code); font-size: 0.9rem; }

        /* Responsive & Overlay */
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); opacity: 0; visibility: hidden; transition: opacity 0.3s, visibility 0.3s; z-index: 1000; }
        body.left-sidebar-open .overlay { opacity: 1; visibility: visible; }
        @media (max-width: 1023px) { .header-title { display: none; } }
        @media (min-width: 1024px) { #left-sidebar { position: static; transform: none; } #menu-toggle { display: none; } .overlay { display: none !important; } }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside id="left-sidebar">
            <div class="sidebar-content">
                <header class="sidebar-header">HaiFire</header>
                <nav class="sidebar-nav">
                    <a href="#" id="home-link" class="nav-link active"><span class="material-symbols-outlined">home</span> Home</a>
                    <a href="#" id="profile-link" class="nav-link" style="display: none;"><span class="material-symbols-outlined">person</span> Profile</a>
                </nav>
                 <div class="sidebar-footer">
                    <nav class="sidebar-nav">
                         <button id="logout-btn" style="display: none;"><span class="material-symbols-outlined">logout</span> Logout</button>
                    </nav>
                </div>
            </div>
        </aside>

        <div class="overlay" id="overlay"></div>

        <div class="main-wrapper">
            <header class="main-header">
                <button class="icon-button" id="menu-toggle"><span class="material-symbols-outlined">menu</span></button>
                <h1 class="header-title">Home</h1>
                <div class="search-wrapper" id="header-search-wrapper">
                     <span class="material-symbols-outlined">search</span>
                     <input type="text" id="search-input" class="search-input" placeholder="Search posts by title...">
                </div>
                <div class="header-actions">
                    <div id="notification-area" style="display: none;">
                        <button class="icon-button" id="notification-bell-btn">
                            <span class="material-symbols-outlined">notifications</span>
                            <span id="notification-count">0</span>
                        </button>
                        <div id="notification-panel">
                            <ul id="notification-list" class="notification-list"></ul>
                        </div>
                    </div>
                    <button class="icon-button" id="login-modal-btn"><span class="material-symbols-outlined">login</span></button>
                </div>
            </header>
            <main class="content-area">
                <!-- Screens -->
                <div id="home-screen" class="screen active">
                    <div class="content-wrapper">
                        <!-- Banner Slider -->
                        <div id="banner-slider-container">
                            <div id="banner-slider-track-wrapper">
                                <div id="banner-slider-track"></div>
                            </div>
                            <button id="banner-prev-btn" class="icon-button banner-slider-nav prev"><span class="material-symbols-outlined">arrow_back_ios_new</span></button>
                            <button id="banner-next-btn" class="icon-button banner-slider-nav next"><span class="material-symbols-outlined">arrow_forward_ios</span></button>
                        </div>
                        <div id="blog-posts-container" style="padding-top: 16px;"></div>
                    </div>
                </div>

                <div id="create-post-screen" class="screen">
                     <div class="content-wrapper">
                        <div class="page-header"> <h2 id="create-post-header">Create a New Post</h2> </div>
                        <form id="create-post-form" class="profile-card">
                            <input type="hidden" id="post-id-input">
                            <div class="form-group"> <label for="post-title">Title</label> <input type="text" id="post-title" required> </div>
                            <div class="form-group"> <label for="post-image-url">Image URL (Optional)</label> <input type="url" id="post-image-url" placeholder="https://example.com/image.png"> </div>
                            <div class="form-group"> <label for="post-button-url">Button URL (Optional)</label> <input type="url" id="post-button-url" placeholder="https://example.com/project-link"> </div>
                            <div class="form-group"> <label for="post-content">Content</label> <textarea id="post-content" required placeholder="Write your content."></textarea> </div>
                            <div class="profile-actions">
                                <button type="button" class="btn btn-secondary" id="cancel-edit-btn" style="display: none;">Cancel</button>
                                <button type="submit" class="btn btn-primary" id="submit-post-btn">Publish Post</button>
                            </div>
                        </form>
                    </div>
                </div>

                <div id="profile-screen" class="screen">
                    <div class="content-wrapper">
                         <div class="page-header"> <h2>Profile</h2> </div>
                         <div class="profile-card">
                             <p><strong>Name:</strong> <span id="user-name"></span></p>
                             <p><strong>Handel:</strong> @<span id="user-handel"></span></p>
                             <p><strong>Email:</strong> <span id="user-email"></span></p>
                             <div class="profile-actions">
                                 <button class="btn btn-secondary" id="edit-profile-btn">Edit Profile</button>
                                 <button class="btn btn-danger" id="delete-account-btn">Delete Account</button>
                             </div>
                         </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Modal and Toast Containers -->
    <div class="modal-container" id="modal-container"></div>
    <div class="toast-container" id="toast-container"></div>

    <!-- Modal Templates -->
    <template id="auth-modal-template">
        <div id="auth-modal" class="modal-overlay">
            <div class="modal-content">
                <div class="modal-header"> <h2 id="auth-modal-title">Login</h2> <button class="icon-button close-modal-btn"><span class="material-symbols-outlined">close</span></button> </div>
                <div class="modal-body">
                    <form id="login-form" class="auth-view active">
                        <div class="form-group"> <label for="login-email">Email</label> <input type="email" id="login-email" required> </div>
                        <div class="form-group"> <label for="login-password">Password</label> <input type="password" id="login-password" required> </div>
                        <button type="submit" class="btn btn-primary" style="width: 100%;">Login</button>
                        <p class="auth-footer-text">Don't have an account? <a href="#" class="show-signup-link">Sign Up</a></p>
                    </form>
                    <form id="signup-form" class="auth-view">
                        <div class="form-group"> <label for="signup-name">Full Name</label> <input type="text" id="signup-name" required> </div>
                        <div class="form-group"> <label for="signup-handel">Handel (e.g. username)</label> <input type="text" id="signup-handel" required pattern="[a-zA-Z0-9_]{3,15}" title="3-15 characters, letters, numbers, and underscores only."> </div>
                        <div class="form-group"> <label for="signup-email">Email</label> <input type="email" id="signup-email" required> </div>
                        <div class="form-group"> <label for="signup-password">Password (min. 6 characters)</label> <input type="password" id="signup-password" required> </div>
                        <button type="submit" class="btn btn-primary" style="width: 100%;">Sign Up</button>
                        <p class="auth-footer-text">Already have an account? <a href="#" class="show-login-link">Login</a></p>
                    </form>
                    <div class="auth-divider">OR</div>
                    <button class="btn btn-secondary btn-google">
                        <svg aria-hidden="true" focusable="false" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 488 512"><path fill="currentColor" d="M488 261.8C488 403.3 391.1 504 248 504 110.8 504 0 393.2 0 256S110.8 8 248 8c66.8 0 126 21.2 172.9 60.7l-67 67C334.6 114.6 293.4 96 248 96c-88.8 0-160 72.2-160 160s71.2 160 160 160c92.6 0 145.5-68.2 149.9-105.5H248V256h239.8c.2 1.5 1 2.9 1.2 4.2z"></path></svg>
                        Sign in with Google
                    </button>
                </div>
            </div>
        </div>
    </template>
    
    <template id="post-detail-modal-template">
        <div id="post-detail-modal" class="modal-overlay">
            <div class="modal-content">
                <div class="modal-header"> <h2 id="post-modal-title"></h2> <button class="icon-button close-modal-btn"><span class="material-symbols-outlined">close</span></button> </div>
                <div class="modal-body">
                    <div id="post-modal-image-container"></div>
                    <p><em>By <span id="post-modal-author"></span></em></p>
                    <div id="post-modal-content"></div>
                </div>
                <div class="modal-footer" id="post-modal-footer"></div>
            </div>
        </div>
    </template>

    <template id="edit-profile-modal-template">
        <div id="edit-profile-modal" class="modal-overlay">
            <div class="modal-content">
                <div class="modal-header"> <h2>Edit Profile</h2> <button class="icon-button close-modal-btn"><span class="material-symbols-outlined">close</span></button> </div>
                <div class="modal-body">
                    <form id="edit-profile-form">
                        <div class="form-group"> <label for="edit-name">Full Name</label> <input type="text" id="edit-name" required> </div>
                        <div class="form-group"> <label for="edit-handel">Handel</label> <input type="text" id="edit-handel" required pattern="[a-zA-Z0-9_]{3,15}" title="3-15 characters, letters, numbers, and underscores only."> </div>
                        <p style="font-size: 0.9rem; color: var(--text-secondary);">Email address cannot be changed.</p>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary close-modal-btn">Cancel</button>
                    <button type="submit" form="edit-profile-form" class="btn btn-primary">Save Changes</button>
                </div>
            </div>
        </div>
    </template>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <!-- App Script -->
    <script>
        // ===================================================================================
        // ===================================================================================
        //
        //                              !!!   CRITICAL   !!!
        //
        //   REPLACE THE CONFIGURATION BELOW WITH YOUR OWN FIREBASE PROJECT'S CONFIGURATION.
        //
        // ===================================================================================
        const firebaseConfig = {
  apiKey: "AIzaSyCGEGXT8e1uY3b_NXQTXomF3odjk88AftU",
  authDomain: "haifire-india.firebaseapp.com",
  databaseURL: "https://haifire-india-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "haifire-india",
  storageBucket: "haifire-india.firebasestorage.app",
  messagingSenderId: "25424393934",
  appId: "1:25424393934:web:a678d02ad684034d4b429f"
};
        // ===================================================================================

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        let allPosts = [];
        let notificationsListener = null;
        let isNewUserSignup = false; // Flag to manage "Welcome" toasts

        // DOM Elements
        const loginModalBtn = document.getElementById('login-modal-btn');
        const logoutBtn = document.getElementById('logout-btn');
        const createPostForm = document.getElementById('create-post-form');
        const blogPostsContainer = document.getElementById('blog-posts-container');
        const searchInput = document.getElementById('search-input');
        const searchWrapper = document.getElementById('header-search-wrapper');
        const cancelEditBtn = document.getElementById('cancel-edit-btn');
        const menuToggle = document.getElementById('menu-toggle');
        const overlay = document.getElementById('overlay');
        const modalContainer = document.getElementById('modal-container');
        const submitPostBtn = document.getElementById('submit-post-btn');
        const notificationArea = document.getElementById('notification-area');
        const notificationBellBtn = document.getElementById('notification-bell-btn');
        const notificationCount = document.getElementById('notification-count');
        const notificationPanel = document.getElementById('notification-panel');
        const notificationList = document.getElementById('notification-list');
        const deleteAccountBtn = document.getElementById('delete-account-btn');
        const editProfileBtn = document.getElementById('edit-profile-btn');
        
        // --- UI Interactions ---
        menuToggle.addEventListener('click', () => document.body.classList.toggle('left-sidebar-open'));
        overlay.addEventListener('click', () => document.body.classList.remove('left-sidebar-open'));
        loginModalBtn.addEventListener('click', () => showModal('auth-modal'));
        editProfileBtn.addEventListener('click', () => showEditProfileModal());

        // --- Authentication ---
        const handleAuthError = (error) => { console.error(error); showToast(error.message, 'error'); }
        logoutBtn.addEventListener('click', () => auth.signOut());
        deleteAccountBtn.addEventListener('click', () => deleteUserAccount());

        // --- Auth State Observer ---
        auth.onAuthStateChanged(async user => {
            const createPostLinkExists = !!document.getElementById('create-post-link');
            if (user) {
                // User is logged in
                const userDocRef = db.collection('users').doc(user.uid);
                let userDoc = await userDocRef.get();

                if (!userDoc.exists) {
                    const defaultHandel = user.email.split('@')[0].replace(/[^a-zA-Z0-9_]/g, '').slice(0, 15);
                    await userDocRef.set({
                        name: user.displayName || 'New User',
                        handel: defaultHandel,
                        email: user.email,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    userDoc = await userDocRef.get();
                }

                const userData = userDoc.data();
                document.getElementById('user-name').textContent = userData.name || 'N/A';
                document.getElementById('user-handel').textContent = userData.handel || 'N/A';
                document.getElementById('user-email').textContent = userData.email;

                loginModalBtn.style.display = 'none'; 
                logoutBtn.style.display = 'flex';
                notificationArea.style.display = 'block';
                
                if (!isNewUserSignup) {
                    showToast(`Welcome back, ${userData.name || user.email}!`, 'success');
                }
                isNewUserSignup = false; 

                listenForNotifications(user.uid);

                document.getElementById('profile-link').style.display = 'flex';
                if (!createPostLinkExists) {
                    const nav = document.querySelector('.sidebar-nav');
                    const profileLink = document.getElementById('profile-link');
                    const createPostLink = document.createElement('a');
                    createPostLink.href = '#'; createPostLink.id = 'create-post-link'; createPostLink.className = 'nav-link';
                    createPostLink.innerHTML = `<span class="material-symbols-outlined">add_circle</span> Create Post`;
                    nav.insertBefore(createPostLink, profileLink);
                    addNavEventListeners();
                }
            } else {
                // User is logged out
                loginModalBtn.style.display = 'flex'; 
                logoutBtn.style.display = 'none';
                notificationArea.style.display = 'none';
                if (notificationsListener) { 
                    notificationsListener();
                    notificationsListener = null;
                }
                document.getElementById('user-name').textContent = '';
                document.getElementById('user-handel').textContent = '';
                document.getElementById('user-email').textContent = '';
                document.getElementById('profile-link').style.display = 'none';
                const createPostLink = document.getElementById('create-post-link');
                if (createPostLink) createPostLink.remove();
                if (document.querySelector('.screen.active') && ['profile-screen', 'create-post-screen'].includes(document.querySelector('.screen.active').id)) {
                    navigateTo('home');
                }
            }
            if(document.querySelector('#home-screen.active')) renderAllPosts();
        });

        // --- User Account Deletion ---
        async function deleteUserAccount() {
            const user = auth.currentUser;
            if (!user) {
                showToast("No user logged in.", "error");
                return;
            }
            if (!confirm("Are you sure you want to permanently delete your account and all of your posts? This cannot be undone.")) {
                return;
            }
            try {
                const batch = db.batch();
                const postsQuery = await db.collection('posts').where('authorId', '==', user.uid).get();
                postsQuery.forEach(doc => {
                    batch.delete(doc.ref);
                });
                const userDocRef = db.collection('users').doc(user.uid);
                batch.delete(userDocRef);
                await batch.commit();

                await user.delete();
                showToast("Account deleted successfully.", "success");
            } catch (error) {
                console.error("Error deleting account: ", error);
                showToast(`Error deleting account: ${error.message}. You may need to log in again to perform this action.`, 'error');
            }
        }

        // --- Blog Post Management ---
        createPostForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const title = createPostForm['post-title'].value;
            const content = createPostForm['post-content'].value;
            const imageUrl = createPostForm['post-image-url'].value;
            const buttonUrl = createPostForm['post-button-url'].value;
            const postId = createPostForm['post-id-input'].value;
            const user = auth.currentUser;

            if (user && title && content) {
                submitPostBtn.disabled = true;
                const isUpdate = !!postId;
                submitPostBtn.textContent = isUpdate ? 'Updating...' : 'Publishing...';
                const postData = { title, content, imageUrl, buttonUrl };
                
                try {
                    if (isUpdate) {
                        await db.collection('posts').doc(postId).update(postData);
                    } else {
                        const userDoc = await db.collection('users').doc(user.uid).get();
                        const authorName = userDoc.exists ? userDoc.data().name : user.displayName;

                        const newPostRef = await db.collection('posts').add({ 
                            ...postData, 
                            authorId: user.uid, 
                            authorEmail: user.email,
                            authorName: authorName,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp() 
                        });

                        await db.collection('notifications').add({
                            type: 'NEW_POST',
                            message: `A new post "${title}" was published.`,
                            authorEmail: user.email,
                            postId: newPostRef.id,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    }
                    showToast(isUpdate ? 'Post updated successfully!' : 'Post created successfully!');
                    resetCreateForm();
                    // --- UPDATE: Refresh the page instead of navigating ---
                    setTimeout(() => location.reload(), 500);
                } catch (error) {
                    console.error("Error writing document: ", error);
                    showToast('Could not save post. Please try again.', 'error');
                } finally {
                    submitPostBtn.disabled = false;
                }
            }
        });

        // --- Firestore Listeners ---
        db.collection('posts').orderBy('createdAt', 'desc').onSnapshot(snapshot => {
            allPosts = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            if(document.querySelector('#home-screen.active')) renderAllPosts();
        }, error => {
            console.error("Error fetching posts: ", error);
            blogPostsContainer.innerHTML = '<p>Could not fetch posts.</p>';
        });

        // --- Banner Listener ---
        db.collection('banners').orderBy('createdAt', 'desc').onSnapshot(snapshot => {
            const bannerContainer = document.getElementById('banner-slider-container');
            const bannerTrack = document.getElementById('banner-slider-track');
            
            if (snapshot.empty) {
                bannerContainer.style.display = 'none';
                return;
            }

            bannerTrack.innerHTML = '';
            snapshot.docs.forEach(doc => {
                const banner = doc.data();
                if (banner.imageUrl) {
                    const slide = document.createElement('div');
                    slide.className = 'banner-slide';
                    const img = `<img src="${banner.imageUrl}" alt="${banner.name || 'Promotional Banner'}">`;

                    if (banner.redirectUrl) {
                        slide.innerHTML = `<a href="${banner.redirectUrl}" target="_blank" rel="noopener noreferrer">${img}</a>`;
                    } else {
                        slide.innerHTML = img;
                    }
                    bannerTrack.appendChild(slide);
                }
            });
            
            if (bannerTrack.children.length > 0) {
                bannerContainer.style.display = 'block';
                initializeBannerSlider();
            } else {
                bannerContainer.style.display = 'none';
            }

        }, error => {
            console.error("Error fetching banners: ", error);
        });
        
        // --- Rendering & Filtering ---
        searchInput.addEventListener('input', () => renderAllPosts());

        function renderSkeletonLoader() {
            const skeletonHTML = `
                <div class="suggestion-grid">
                    ${Array(6).fill('').map(() => `
                        <div class="suggestion-card skeleton-card">
                            <div class="skeleton skeleton-image"></div>
                            <div class="suggestion-card-content">
                                <div class="skeleton skeleton-title"></div>
                                <div class="skeleton skeleton-text"></div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            blogPostsContainer.innerHTML = skeletonHTML;
        }

        function renderAllPosts() {
            const searchTerm = searchInput.value.toLowerCase();
            const filteredPosts = allPosts.filter(post => post.title.toLowerCase().includes(searchTerm));
            
            if (allPosts.length === 0) {
                 blogPostsContainer.innerHTML = '<p style="padding: 0 16px; color: var(--text-secondary);">No posts yet. Be the first to create one!</p>';
                 return;
            }
            if (filteredPosts.length === 0) {
                blogPostsContainer.innerHTML = '<p style="padding: 0 16px; color: var(--text-secondary);">No posts found for your search.</p>';
                return;
            }

            const postsHTML = '<div class="suggestion-grid">' + filteredPosts.map((post, index) => {
                const postDate = post.createdAt ? new Date(post.createdAt.seconds * 1000).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric'}) : 'Just now';
                const imageHTML = post.imageUrl ? `<img src="${post.imageUrl}" alt="${post.title}" class="suggestion-card-image" onerror="this.style.display='none'">` : '';
                
                return `<a href="#" class="suggestion-card" data-id="${post.id}" style="animation-delay: ${index * 50}ms">
                            ${imageHTML}
                            <div class="suggestion-card-content">
                                <h3>${post.title}</h3>
                                <p>By ${post.authorName || post.authorEmail} on ${postDate}</p>
                            </div>
                        </a>`;
            }).join('') + '</div>';

            blogPostsContainer.innerHTML = postsHTML;
            addPostCardListeners();
        }

        // --- Banner Slider Logic ---
        function initializeBannerSlider() {
            const container = document.getElementById('banner-slider-container');
            const track = document.getElementById('banner-slider-track');
            const prevBtn = document.getElementById('banner-prev-btn');
            const nextBtn = document.getElementById('banner-next-btn');
            const slides = Array.from(track.children);
            let autoSlideInterval;

            if (slides.length <= 1) {
                prevBtn.style.display = 'none';
                nextBtn.style.display = 'none';
                return;
            }
            
            prevBtn.style.display = 'flex';
            nextBtn.style.display = 'flex';

            let currentIndex = 0;

            const updateSlidePosition = () => {
                track.style.transform = `translateX(-${currentIndex * 100}%)`;
            }
            
            const goToNextSlide = () => {
                currentIndex = (currentIndex + 1) % slides.length;
                updateSlidePosition();
            };

            const startAutoSlide = () => {
                stopAutoSlide(); // Ensure no multiple intervals are running
                autoSlideInterval = setInterval(goToNextSlide, 5000); // Slide every 5 seconds
            };

            const stopAutoSlide = () => {
                clearInterval(autoSlideInterval);
            };

            nextBtn.onclick = () => {
                goToNextSlide();
                startAutoSlide(); // Reset timer on manual click
            };

            prevBtn.onclick = () => {
                currentIndex = (currentIndex - 1 + slides.length) % slides.length;
                updateSlidePosition();
                startAutoSlide(); // Reset timer on manual click
            };
            
            container.addEventListener('mouseenter', stopAutoSlide);
            container.addEventListener('mouseleave', startAutoSlide);

            // Initialize position and start auto-sliding
            updateSlidePosition();
            startAutoSlide();
        }

        // --- Post Interaction (View, Edit, Delete) ---
        function addPostCardListeners() {
            document.querySelectorAll('.suggestion-card').forEach(card => {
                card.addEventListener('click', (e) => {
                    e.preventDefault();
                    const post = allPosts.find(p => p.id === card.dataset.id);
                    if (post) showPostDetailModal(post);
                    else showToast("Error: Post not found.", 'error');
                });
            });
        }
        
        function editPost(postId) {
            const post = allPosts.find(p => p.id === postId);
            if(post) {
                document.getElementById('create-post-header').textContent = 'Edit Your Post';
                submitPostBtn.textContent = 'Update Post';
                document.getElementById('post-id-input').value = post.id;
                document.getElementById('post-title').value = post.title;
                document.getElementById('post-image-url').value = post.imageUrl || '';
                document.getElementById('post-button-url').value = post.buttonUrl || '';
                document.getElementById('post-content').value = post.content;
                cancelEditBtn.style.display = 'inline-flex';
                closeAllModals();
                navigateTo('create-post');
            }
        }
        
        function deletePost(postId) {
            if (confirm("Are you sure you want to delete this post? This cannot be undone.")) {
                db.collection('posts').doc(postId).delete()
                  .then(() => { showToast("Post deleted."); closeAllModals(); })
                  .catch(error => { console.error("Error deleting post: ", error); showToast("Error deleting post.", 'error'); });
            }
        }

        cancelEditBtn.addEventListener('click', () => { resetCreateForm(); navigateTo('home'); });

        function resetCreateForm() {
            document.getElementById('post-id-input').value = ''; 
            document.getElementById('create-post-header').textContent = 'Create a New Post';
            submitPostBtn.textContent = 'Publish Post';
            submitPostBtn.disabled = false;
            cancelEditBtn.style.display = 'none';
            createPostForm.reset();
        }

        // --- Notification Logic ---
        function listenForNotifications() {
            if (notificationsListener) notificationsListener(); 
            const lastChecked = localStorage.getItem('lastNotificationCheck') ? new Date(parseInt(localStorage.getItem('lastNotificationCheck'))) : new Date(0);
            
            notificationsListener = db.collection('notifications').orderBy('createdAt', 'desc').limit(15)
                .onSnapshot(snapshot => {
                    const allNotifs = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    const unreadNotifs = allNotifs.filter(notif => notif.createdAt && new Date(notif.createdAt.seconds * 1000) > lastChecked);
                    renderNotifications(allNotifs, unreadNotifs.length);
                }, error => console.error("Error fetching notifications:", error));
        }
        
        function renderNotifications(notifs, unreadCount) {
            notificationCount.textContent = unreadCount > 9 ? '9+' : unreadCount;
            notificationCount.classList.toggle('visible', unreadCount > 0);
            
            if (notifs.length === 0) {
                notificationList.innerHTML = '<li class="no-notifications">You have no notifications yet.</li>';
                return;
            }
            const lastChecked = localStorage.getItem('lastNotificationCheck') ? new Date(parseInt(localStorage.getItem('lastNotificationCheck'))) : new Date(0);
            notificationList.innerHTML = notifs.map(notif => {
                const isUnread = notif.createdAt && new Date(notif.createdAt.seconds * 1000) > lastChecked;
                const notifDate = notif.createdAt ? new Date(notif.createdAt.seconds * 1000).toLocaleString() : '';
                return `<li class="notification-item ${isUnread ? 'unread' : ''}" data-post-id="${notif.postId}"><p>${notif.message}</p><span>By ${notif.authorEmail} on ${notifDate}</span></li>`;
            }).join('');
        }

        notificationBellBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            notificationPanel.classList.toggle('visible');
            if (notificationPanel.classList.contains('visible')) {
                notificationCount.classList.remove('visible');
                localStorage.setItem('lastNotificationCheck', Date.now().toString());
                setTimeout(() => document.querySelectorAll('.notification-item.unread').forEach(item => item.classList.remove('unread')), 2000);
            }
        });

        notificationList.addEventListener('click', (e) => {
            const item = e.target.closest('.notification-item');
            if (item && item.dataset.postId) {
                const post = allPosts.find(p => p.id === item.dataset.postId);
                if (post) {
                    showPostDetailModal(post);
                    notificationPanel.classList.remove('visible');
                } else {
                    showToast("Post not found. It may have been deleted.", 'error');
                }
            }
        });

        document.addEventListener('click', (e) => {
            if (notificationArea && !notificationArea.contains(e.target)) {
                notificationPanel.classList.remove('visible');
            }
        });

        // --- Post Content Formatting ---
        function formatPostContent(text = '') {
            const escapeHTML = (str) => str.replace(/[&<>'"]/g, tag => ({'&': '&amp;', '<': '&lt;', '>': '&gt;', "'": '&#39;', '"': '&quot;'}[tag] || tag));
            const codeBlockRegex = /```(\w*)\n([\s\S]+?)```/g;
            let resultHTML = '', lastIndex = 0;
            try {
                text.replace(codeBlockRegex, (match, lang, code, offset) => {
                    const precedingText = text.slice(lastIndex, offset);
                    if (precedingText.trim()) resultHTML += `<p>${escapeHTML(precedingText).replace(/\n/g, '<br>')}</p>`;
                    const language = escapeHTML(lang || 'plaintext');
                    const escapedCode = escapeHTML(code);
                    const previewBtn = (language.toLowerCase() === 'html') ? `<button title="Preview HTML" class="icon-button preview-code-btn"><span class="material-symbols-outlined">visibility</span></button>` : '';
                    resultHTML += `<div class="pre-container"><div class="pre-header"><span class="code-lang-name">${language}</span><div class="pre-header-actions">${previewBtn}<button title="Download" class="icon-button download-code-btn"><span class="material-symbols-outlined">download</span></button><button title="Copy" class="icon-button copy-code-btn"><span class="material-symbols-outlined">content_copy</span></button><button title="Show/Hide" class="icon-button toggle-code-btn"><span class="material-symbols-outlined">unfold_less</span></button></div></div><pre><code class="language-${language}">${escapedCode}</code></pre></div>`;
                    lastIndex = offset + match.length;
                    return ''; 
                });
                const remainingText = text.slice(lastIndex);
                if (remainingText.trim()) resultHTML += `<p>${escapeHTML(remainingText).replace(/\n/g, '<br>')}</p>`;
                return resultHTML || `<p>${escapeHTML(text).replace(/\n/g, '<br>')}</p>`;
            } catch (e) {
                console.error("Error formatting post:", e);
                return `<p style="color:var(--error-color);">Error rendering post.</p><pre>${escapeHTML(text)}</pre>`;
            }
        }
        
        // --- Add Listeners for Code Box Buttons ---
        function addCodeBlockListeners(container) {
            const langExtMap = { javascript: 'js', python: 'py', html: 'html', css: 'css', sql: 'sql', java: 'java', csharp: 'cs', shell: 'sh', bash: 'sh' };
            container.querySelectorAll('.pre-container').forEach(preContainer => {
                const codeBlock = preContainer.querySelector('code');
                const lang = preContainer.querySelector('.code-lang-name').textContent.toLowerCase();
                const codeContent = codeBlock.textContent;
                preContainer.querySelector('.copy-code-btn')?.addEventListener('click', () => navigator.clipboard.writeText(codeContent).then(() => showToast('Copied!', 'success')).catch(() => showToast('Copy failed.', 'error')));
                preContainer.querySelector('.download-code-btn')?.addEventListener('click', () => {
                    const blob = new Blob([codeContent], { type: 'text/plain' });
                    const a = document.createElement('a');
                    a.href = URL.createObjectURL(blob);
                    a.download = `snippet.${langExtMap[lang] || 'txt'}`;
                    a.click();
                    URL.revokeObjectURL(a.href);
                });
                preContainer.querySelector('.toggle-code-btn')?.addEventListener('click', (e) => {
                    const btn = e.currentTarget, icon = btn.querySelector('.material-symbols-outlined'), pre = preContainer.querySelector('pre');
                    pre.classList.toggle('code-collapsed');
                    icon.textContent = pre.classList.contains('code-collapsed') ? 'unfold_more' : 'unfold_less';
                });
                preContainer.querySelector('.preview-code-btn')?.addEventListener('click', () => {
                    const blob = new Blob([codeContent], { type: 'text/html' });
                    window.open(URL.createObjectURL(blob), '_blank');
                });
            });
        }

        // --- Modal Management ---
        function initializeModals() {
            document.querySelectorAll('template').forEach(template => modalContainer.appendChild(template.content.cloneNode(true)));
            
            const authModal = document.getElementById('auth-modal');
            const loginForm = authModal.querySelector('#login-form');
            const signupForm = authModal.querySelector('#signup-form');
            const authModalTitle = authModal.querySelector('#auth-modal-title');
            const editProfileForm = document.getElementById('edit-profile-form');

            // --- AUTH MODAL LOGIC ---
            authModal.querySelector('.show-signup-link').addEventListener('click', (e) => { e.preventDefault(); loginForm.classList.remove('active'); signupForm.classList.add('active'); authModalTitle.textContent = "Sign Up"; });
            authModal.querySelector('.show-login-link').addEventListener('click', (e) => { e.preventDefault(); signupForm.classList.remove('active'); loginForm.classList.add('active'); authModalTitle.textContent = "Login"; });
            
            signupForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const name = signupForm['signup-name'].value;
                const handel = signupForm['signup-handel'].value.toLowerCase();
                const email = signupForm['signup-email'].value;
                const password = signupForm['signup-password'].value;
                const signupBtn = signupForm.querySelector('button[type="submit"]');

                signupBtn.disabled = true;
                signupBtn.textContent = 'Signing Up...';

                const handelQuery = await db.collection('users').where('handel', '==', handel).get();
                if (!handelQuery.empty) {
                    showToast('This handel is already taken.', 'error');
                    signupBtn.disabled = false;
                    signupBtn.textContent = 'Sign Up';
                    return;
                }

                try {
                    const { user } = await auth.createUserWithEmailAndPassword(email, password);
                    await user.updateProfile({ displayName: name });
                    
                    const userDocRef = db.collection('users').doc(user.uid);
                    await userDocRef.set({
                        name: name,
                        handel: handel,
                        email: user.email,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });

                    isNewUserSignup = true; 
                    showToast('Account created successfully!', 'success');
                    setTimeout(() => location.reload(), 1000);

                } catch (error) {
                    handleAuthError(error);
                    signupBtn.disabled = false; 
                    signupBtn.textContent = 'Sign Up';
                }
            });

            loginForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const loginBtn = loginForm.querySelector('button[type="submit"]');
                loginBtn.disabled = true;
                loginBtn.textContent = 'Logging In...';

                auth.signInWithEmailAndPassword(loginForm['login-email'].value, loginForm['login-password'].value)
                    .then(() => {
                        setTimeout(() => location.reload(), 500);
                    })
                    .catch(error => {
                        handleAuthError(error);
                        loginBtn.disabled = false; 
                        loginBtn.textContent = 'Login';
                    });
            });
            
            authModal.querySelector('.btn-google').addEventListener('click', () => {
                const provider = new firebase.auth.GoogleAuthProvider();
                auth.signInWithPopup(provider)
                    .then(() => {
                        setTimeout(() => location.reload(), 500);
                    })
                    .catch(handleAuthError);
            });

            // --- EDIT PROFILE MODAL LOGIC ---
            editProfileForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const user = auth.currentUser;
                const newName = document.getElementById('edit-name').value;
                const newHandel = document.getElementById('edit-handel').value.toLowerCase();
                const saveBtn = editProfileForm.closest('.modal-content').querySelector('.btn-primary');

                if (!user) return;
                saveBtn.disabled = true;

                try {
                    const userDocRef = db.collection('users').doc(user.uid);
                    const userDoc = await userDocRef.get();
                    const currentHandel = userDoc.data()?.handel;

                    if (newHandel !== currentHandel) {
                        const handelQuery = await db.collection('users').where('handel', '==', newHandel).get();
                        if (!handelQuery.empty) {
                            showToast('This handel is already taken.', 'error');
                            return;
                        }
                    }

                    const batch = db.batch();
                    batch.update(userDocRef, { name: newName, handel: newHandel });
                    const postsQuery = await db.collection('posts').where('authorId', '==', user.uid).get();
                    postsQuery.forEach(doc => batch.update(doc.ref, { authorName: newName }));

                    await batch.commit();
                    await user.updateProfile({ displayName: newName });
                    
                    document.getElementById('user-name').textContent = newName;
                    document.getElementById('user-handel').textContent = newHandel;

                    showToast('Profile updated successfully!', 'success');
                    closeAllModals();
                } catch (error) {
                    console.error("Error updating profile: ", error);
                    showToast('Failed to update profile.', 'error');
                } finally {
                    saveBtn.disabled = false;
                }
            });

            // Generic close listeners for all modals
            modalContainer.querySelectorAll('.modal-overlay').forEach(modal => {
                modal.addEventListener('click', e => { if (e.target === modal) closeAllModals(); });
                modal.querySelectorAll('.close-modal-btn').forEach(btn => btn.addEventListener('click', () => closeAllModals()));
            });
        }

        async function showEditProfileModal() {
            const user = auth.currentUser;
            if (!user) return;
            const userDoc = await db.collection('users').doc(user.uid).get();
            if (userDoc.exists) {
                const { name, handel } = userDoc.data();
                document.getElementById('edit-name').value = name || '';
                document.getElementById('edit-handel').value = handel || '';
            }
            showModal('edit-profile-modal');
        }

        function showPostDetailModal(post) {
            const modalEl = document.getElementById('post-detail-modal');
            const modalBody = modalEl.querySelector('.modal-body');
            const imageContainer = modalEl.querySelector('#post-modal-image-container');
            const contentContainer = modalEl.querySelector('#post-modal-content');
            const footer = modalEl.querySelector('#post-modal-footer');

            imageContainer.innerHTML = '';
            contentContainer.innerHTML = '';
            footer.innerHTML = '';
            modalBody.querySelector('.open-link-container')?.remove();

            if (post.imageUrl) {
                const img = document.createElement('img');
                img.src = post.imageUrl;
                img.alt = post.title;
                img.onerror = () => { img.style.display='none'; };
                imageContainer.appendChild(img);
            }

            modalEl.querySelector('#post-modal-title').textContent = post.title;
            modalEl.querySelector('#post-modal-author').textContent = post.authorName || post.authorEmail;
            contentContainer.innerHTML = formatPostContent(post.content);
            
            if (post.buttonUrl) {
                const openBtnContainer = document.createElement('div');
                openBtnContainer.className = 'open-link-container';
                const openBtn = document.createElement('a');
                openBtn.href = post.buttonUrl;
                openBtn.target = '_blank';
                openBtn.rel = 'noopener noreferrer';
                openBtn.className = 'btn btn-primary btn-open-link';
                openBtn.innerHTML = `<span class="material-symbols-outlined" style="margin-right: 8px;">open_in_new</span> OPEN`;
                openBtnContainer.appendChild(openBtn);
                modalBody.appendChild(openBtnContainer);
            }
            
            contentContainer.querySelectorAll('pre code').forEach(block => hljs.highlightElement(block));
            addCodeBlockListeners(contentContainer);
            
            const user = auth.currentUser;
            if (user && user.uid === post.authorId) {
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'btn btn-danger'; deleteBtn.textContent = 'Delete';
                deleteBtn.addEventListener('click', () => deletePost(post.id));
                const editBtn = document.createElement('button');
                editBtn.className = 'btn btn-primary'; editBtn.textContent = 'Edit';
                editBtn.addEventListener('click', () => editPost(post.id));
                footer.append(deleteBtn, editBtn);
            }
            showModal('post-detail-modal');
        }
        
        function showModal(id) {
            const modal = document.getElementById(id);
            if(modal) modal.classList.add('visible');
        }

        function closeAllModals() {
            modalContainer.querySelectorAll('.modal-overlay.visible').forEach(modal => modal.classList.remove('visible'));
        }

        function showToast(message, type = 'success') {
            const toastContainer = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            toastContainer.appendChild(toast);
            setTimeout(() => toast.classList.add('show'), 10);
            setTimeout(() => {
                toast.classList.remove('show');
                toast.addEventListener('transitionend', () => toast.remove());
            }, 3000);
        }

        const headerTitle = document.querySelector('.header-title');
        function navigateTo(screenId) {
            document.querySelector('.screen.active')?.classList.remove('active');
            const targetScreen = document.getElementById(`${screenId}-screen`);
            if (targetScreen) targetScreen.classList.add('active');
            
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            const activeLink = document.getElementById(`${screenId}-link`);
            if(activeLink) activeLink.classList.add('active');
            
            headerTitle.textContent = activeLink ? activeLink.textContent.trim() : 'HaiFire';
            document.body.classList.remove('left-sidebar-open');
            
            if (screenId === 'home') {
                searchWrapper.style.display = 'block';
                if (allPosts.length === 0) {
                    renderSkeletonLoader();
                }
            } else {
                searchWrapper.style.display = 'none';
            }
        };
        
        function addNavEventListeners() {
            document.querySelectorAll('.nav-link').forEach(link => {
                link.replaceWith(link.cloneNode(true)); // Re-clone to remove old listeners
            });
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const screenId = e.currentTarget.id.replace('-link', '');
                    if(screenId === 'create-post') resetCreateForm();
                    navigateTo(screenId);
                });
            });
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            initializeModals();
            addNavEventListeners();
            navigateTo('home');

            // --- Global Button Click Animation Listener ---
            document.addEventListener('click', function(e) {
                const target = e.target.closest('button, a.btn, .icon-button');
                if (target && !target.disabled) {
                    target.classList.add('button-press-animation');
                    target.addEventListener('animationend', () => {
                        target.classList.remove('button-press-animation');
                    }, { once: true });
                }
            });
        });
    </script>
</body>
</html>
